@using Microsoft.AspNetCore.Identity.Data

@rendermode InteractiveServer
@page "/"


@inject IConfiguration Configuration
@inject mynydd.Services.DataStore DataStore


<PageTitle>Mynydd</PageTitle>

@if (_loggedIn)
{
    <div id="main-container">
        <InputTextArea id="main-textarea" @bind-Value="_text" />
        <div id="main-actions">
            <a id="action-new" href="#" @onclick="OnNewClick">New</a>
            <a id="action-save" href="#" @onclick="OnSaveClick">Save</a>
            <a id="action-delete" href="#" @onclick="OnDeleteClick">Delete</a>
        </div>
    </div>
}
else
{
    <input type="password" @onchange="OnKeyDown"/>
}   

@code {

    private bool _loggedIn = false;
    private string _text = string.Empty;

    private async Task OnKeyDown(ChangeEventArgs e)
    {
        if (e.Value?.ToString() == Configuration["Mynydd:LoginToken"])
        {
            _loggedIn = true;
        }        
    }

    private void OnNewClick()
    {
        // TODO: Add logic for New
    }

    private void OnSaveClick()
    {
        DataStore.InsertNote(_text);
    }

    private void OnDeleteClick()
    {
        // TODO: Add logic for Delete
    }
}